<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link href="css/style.css" type="text/css" rel="stylesheet" />
    <title></title>
  </head>
  <body>
    <div class="container">
      <h1>ToDo</h1>
      <form>
        <label><h2>Add a ToDo</h2>
          <input id="newTodo" />
        </label>
        <button id="addTodoBtn">Add</button>
      </form>
      <section>
        <h2>ToDos</h2>
        <div id="todolist"></div>
      </section>
    </div>

    <div id="TodoTemplate">
      <div><input type="checkbox" /><label></label></div>
    </div>

    <script>
      /**
       * This function is used to remove an item from the todo array
       * in response to the user clicking the item's checkbox.
       */
      function removeTodo(evt){
        // get the index of this todo in the array from a custom attribute
        let todoIndex = evt.target.getAttribute('data-todo-index');
        // use splice to remove the item from the array
        todos.splice(todoIndex, 1);
        // redraw the todo list
        drawTodos();
      }

      /**
       * This function is used to redraw the list of todo items.
       */
      function drawTodos(){
        // get a reference to the list container
        let todolist = document.getElementById('todolist');
        // empty the list container
        todolist.innerHTML = "";
        //get a reference to the list item template
        let todoTemplate = document.querySelector('#TodoTemplate div');
        // loop over the array of todos
        for(let i = 0; i < todos.length; i++){
          // create a copy of the HTML template
          let newTodo = todoTemplate.cloneNode(true);
          // get the label in the template
          let label = newTodo.querySelector('label');
          // set the label's text to that of this array item
          label.textContent = todos[i];

          // get a reference to the checkbox in the template
          let checkbox = newTodo.querySelector('input');
          // add an event listener to remove this item when clicked
          checkbox.addEventListener('click', removeTodo);
          // add a custom attribute so the remove function knows which item to remove
          checkbox.setAttribute('data-todo-index', i);
          // add this template to the list container
          todolist.appendChild(newTodo);
        }
      }

      /**
       * This function adds the new todo to the array
       */
      function addTodo(evt){
        // stop the default behaviour of submitting the form
        evt.preventDefault();
        // get the value from the input
        let newTodo = document.getElementById("newTodo").value;
        // check there's somethign in there!
        if (newTodo) {
          // add the item to the array
          todos.push(newTodo);
        }
        // redraw the list of todo items.
        drawTodos();
      };

      // create an empty array on first load
      let todos = [];
      // add an event listener to the 'add' button to add a new todo.
      document.getElementById("addTodoBtn").addEventListener("click", addTodo);
    </script>
  </body>
</html>
